<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>TenderWin Workstation</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white p-6">
    <div class="max-w-3xl mx-auto space-y-6">
        <div class="bg-slate-900 p-10 rounded-[3rem] border border-slate-800">
            <h1 class="text-2xl font-black text-blue-500 mb-6 uppercase tracking-tighter italic">TenderWin Engine v4</h1>
            <input id="title" type="text" placeholder="Judul Proyek" class="w-full p-4 bg-slate-950 border border-slate-800 rounded-2xl mb-4 text-white font-bold">
            <textarea id="brief" rows="6" placeholder="Rincian kasar proyek..." class="w-full p-4 bg-slate-950 border border-slate-800 rounded-2xl mb-6 text-white"></textarea>
            <button id="btn" onclick="gas()" class="w-full py-5 bg-blue-600 rounded-[2rem] font-black text-xl shadow-lg shadow-blue-500/20 active:scale-95 transition-all">GENERATE PROPOSAL SENIOR</button>
        </div>

        <div id="wait" class="hidden text-center py-10 animate-pulse text-blue-400 font-bold uppercase text-xs tracking-widest">TenderEngine sedang mengonstruksi narasi strategis...</div>

        <div id="resultArea" class="hidden bg-white text-slate-900 p-10 rounded-[3rem] shadow-2xl">
            <div id="out" class="whitespace-pre-wrap leading-relaxed text-sm font-medium"></div>
        </div>
    </div>

    <script>
        const client = new Appwrite.Client().setEndpoint('https://sgp.cloud.appwrite.io/v1').setProject('tenderwin');
        const functions = new Appwrite.Functions(client);
        const db = new Appwrite.Databases(client);

        async function gas() {
            const title = document.getElementById('title').value;
            const brief = document.getElementById('brief').value;
            if(!title || !brief) return alert("Isi dulu anjing!");

            document.getElementById('wait').classList.remove('hidden');
            document.getElementById('resultArea').classList.add('hidden');

            try {
                // ID Function: generateProposal
                const exec = await functions.createExecution('generateProposal', JSON.stringify({ title, brief }));
                const res = JSON.parse(exec.responseBody);

                if (res.success) {
                    document.getElementById('out').innerText = res.proposal;
                    document.getElementById('resultArea').classList.remove('hidden');
                    
                    await db.createDocument('main_db', 'proposals', Appwrite.ID.unique(), {
                        nama_proposal: title,
                        final_proposal: res.proposal,
                        vendor_name: localStorage.getItem('wa') || "User"
                    });
                } else { alert("AI Gagal: " + res.error); }
            } catch (e) { alert("Sistem Error: " + e.message); }
            finally { document.getElementById('wait').classList.add('hidden'); }
        }
    </script>
</body>
</html>
