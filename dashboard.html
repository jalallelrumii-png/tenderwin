<script>
    const { Client, Functions, Databases, ID } = Appwrite;
    const client = new Client().setEndpoint('https://sgp.cloud.appwrite.io/v1').setProject('tenderwin');
    const functions = new Functions(client);
    const db = new Databases(client);

    async function generate() {
        const title = document.getElementById('title').value;
        const brief = document.getElementById('brief').value;

        if(!title || !brief) return alert('Isi data dulu!');

        document.getElementById('wait').classList.remove('hidden');
        try {
            // GANTI 'generateProposal' dengan ID Function lo kalau beda!
            const execution = await functions.createExecution(
                'generateProposal', 
                JSON.stringify({ title, brief })
            );

            const response = JSON.parse(execution.responseBody);
            
            if (response.success) {
                document.getElementById('out').innerText = response.proposal;
                document.getElementById('resultArea').classList.remove('hidden');

                // Simpan ke Database
                await db.createDocument('main_db', 'proposals', ID.unique(), {
                    nama_proposal: title,
                    final_proposal: response.proposal,
                    vendor_name: localStorage.getItem('wa')
                });
            } else {
                alert('Gagal AI: ' + response.error);
            }
        } catch (e) {
            alert('Error Sistem: ' + e.message);
        } finally {
            document.getElementById('wait').classList.add('hidden');
        }
    }
</script>
